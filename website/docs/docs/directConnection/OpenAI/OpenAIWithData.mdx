---
sidebar_position: 16
---

# OpenAI with External Data

Learn how to load data from CSV or JSON files (including Google Cloud Storage) and use it with OpenAI's chat API.

:::tip Try the Live Demos
ðŸŽ® **<a href="/deep-chat/demos/openai-csv-data-with-charts.html" target="_blank">Demo with Charts</a>** - Chat with data and generate visualizations!

ðŸ“Š **<a href="/deep-chat/demos/openai-csv-data.html" target="_blank">Basic Demo</a>** - Chat with CSV/JSON data
:::

## Overview

This feature allows you to:
- Load data from CSV or JSON files stored on Google Cloud Storage or any public URL
- Automatically include that data as context for OpenAI conversations
- Enable AI to answer questions about your data

## Example: Loading CSV Data

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import BrowserOnly from '@docusaurus/BrowserOnly';

<Tabs>
<TabItem value="html" label="HTML">

```html
<!DOCTYPE html>
<html>
  <head>
    <script type="module">
      import { loadRemoteData, createDataContextPrompt } from './utils/dataLoader.js';

      async function setupChat() {
        try {
          // Load data from Google Cloud Storage
          const data = await loadRemoteData(
            'https://storage.googleapis.com/your-bucket/yourfile.csv',
            'csv'
          );

          // Create system prompt with data context
          const systemPrompt = createDataContextPrompt(
            data,
            'You are a helpful assistant that can analyze and answer questions about the provided dataset.',
            50 // Include first 50 rows as context
          );

          // Get chat component
          const chatElement = document.getElementById('chat');

          // Configure with OpenAI and data context
          chatElement.directConnection = {
            openAI: {
              key: 'YOUR_API_KEY',
              chat: {
                system_prompt: systemPrompt,
                model: 'gpt-4o',
                max_tokens: 2000,
              },
            },
          };
        } catch (error) {
          console.error('Error loading data:', error);
        }
      }

      // Load data when page loads
      window.addEventListener('load', setupChat);
    </script>
  </head>
  <body>
    <deep-chat id="chat" style="height: 500px"></deep-chat>
    <script type="module" src="https://cdn.jsdelivr.net/npm/deep-chat"></script>
  </body>
</html>
```

</TabItem>
<TabItem value="react" label="React">

```jsx
import React, { useEffect, useState } from 'react';
import { DeepChat } from 'deep-chat-react';
import { loadRemoteData, createDataContextPrompt } from './utils/dataLoader';

export default function ChatWithData() {
  const [directConnection, setDirectConnection] = useState(null);

  useEffect(() => {
    async function loadData() {
      try {
        // Load CSV data from Google Cloud Storage
        const data = await loadRemoteData(
          'https://storage.googleapis.com/gdsshopify/MonteCarlo.csv',
          'csv'
        );

        // Create system prompt with data context
        const systemPrompt = createDataContextPrompt(
          data,
          'You are a helpful assistant that can analyze and answer questions about the provided dataset.',
          50
        );

        // Set up OpenAI connection with data context
        setDirectConnection({
          openAI: {
            key: process.env.REACT_APP_OPENAI_KEY,
            chat: {
              system_prompt: systemPrompt,
              model: 'gpt-4o',
              max_tokens: 2000,
            },
          },
        });
      } catch (error) {
        console.error('Error loading data:', error);
        // Handle error - maybe show a message to user
      }
    }

    loadData();
  }, []);

  if (!directConnection) {
    return <div>Loading data...</div>;
  }

  return (
    <DeepChat
      directConnection={directConnection}
      style={{ height: '500px' }}
    />
  );
}
```

</TabItem>
<TabItem value="vue" label="Vue">

```vue
<template>
  <div>
    <div v-if="loading">Loading data...</div>
    <deep-chat
      v-else
      :directConnection="directConnection"
      style="height: 500px"
    />
  </div>
</template>

<script>
import { loadRemoteData, createDataContextPrompt } from './utils/dataLoader';

export default {
  name: 'ChatWithData',
  data() {
    return {
      loading: true,
      directConnection: null,
    };
  },
  async mounted() {
    try {
      // Load CSV data
      const data = await loadRemoteData(
        'https://storage.googleapis.com/gdsshopify/MonteCarlo.csv',
        'csv'
      );

      // Create system prompt with data context
      const systemPrompt = createDataContextPrompt(
        data,
        'You are a helpful assistant that can analyze and answer questions about the provided dataset.',
        50
      );

      // Configure OpenAI connection
      this.directConnection = {
        openAI: {
          key: process.env.VUE_APP_OPENAI_KEY,
          chat: {
            system_prompt: systemPrompt,
            model: 'gpt-4o',
            max_tokens: 2000,
          },
        },
      };
    } catch (error) {
      console.error('Error loading data:', error);
    } finally {
      this.loading = false;
    }
  },
};
</script>
```

</TabItem>
</Tabs>

## Loading JSON Data

```javascript
import { loadRemoteData, createDataContextPrompt } from './utils/dataLoader';

// Load JSON data
const data = await loadRemoteData(
  'https://storage.googleapis.com/your-bucket/data.json',
  'json'
);

// Create context prompt
const systemPrompt = createDataContextPrompt(
  data,
  'You are an assistant that helps analyze JSON data.',
  100
);
```

## API Reference

### `loadRemoteData(url, type)`

Loads and parses data from a remote URL.

**Parameters:**
- `url` (string): The URL of the file to load
- `type` (string): Either 'csv' or 'json'

**Returns:** `Promise<Array<Object>|Object>` - The parsed data

### `createDataContextPrompt(data, basePrompt, maxRows)`

Creates a system prompt that includes data context.

**Parameters:**
- `data` (Array|Object): The data to include
- `basePrompt` (string): Base system prompt text
- `maxRows` (number): Maximum rows to include (default: 50)

**Returns:** `string` - Complete system prompt with data context

### `formatDataForAI(data, maxRows)`

Formats data array into text suitable for AI context.

**Parameters:**
- `data` (Array): Data array to format
- `maxRows` (number): Maximum rows to include (default: 50)

**Returns:** `string` - Formatted text representation

## Best Practices

### 1. Limit Data Size

Only include relevant data in the context. Large datasets can exceed token limits:

```javascript
// Good: Limit to 50 rows
const systemPrompt = createDataContextPrompt(data, basePrompt, 50);

// Bad: Including thousands of rows
const systemPrompt = createDataContextPrompt(data, basePrompt, 5000);
```

### 2. Handle Errors Gracefully

Always handle potential errors when loading remote data:

```javascript
try {
  const data = await loadRemoteData(url, 'csv');
  // Use data...
} catch (error) {
  console.error('Failed to load data:', error);
  // Show user-friendly error message
}
```

### 3. Cache Data

If the data doesn't change frequently, cache it to avoid repeated fetches:

```javascript
let cachedData = null;

async function getData() {
  if (!cachedData) {
    cachedData = await loadRemoteData(url, 'csv');
  }
  return cachedData;
}
```

### 4. CORS Considerations

Ensure your data files are accessible from your domain. For Google Cloud Storage:

1. Make the bucket or file public
2. Set appropriate CORS configuration

Example GCS CORS configuration:
```json
[
  {
    "origin": ["*"],
    "method": ["GET"],
    "responseHeader": ["Content-Type"],
    "maxAgeSeconds": 3600
  }
]
```

### 5. Secure API Keys

Never expose your OpenAI API key in client-side code for production:

```javascript
// Development only
directConnection: {
  openAI: {
    key: 'YOUR_API_KEY', // Don't do this in production!
  }
}

// Production: Use environment variables and a backend proxy
directConnection: {
  openAI: {
    key: process.env.OPENAI_KEY,
  }
}
```

## Example Questions Users Can Ask

Once your data is loaded, users can ask questions like:

- "What are the columns in this dataset?"
- "What's the average value of [column name]?"
- "Show me the top 5 rows"
- "Are there any trends in the data?"
- "What's the maximum/minimum value for [column name]?"
- "Filter data where [column] equals [value]"

## Advanced: Custom Data Processing

You can preprocess the data before passing it to OpenAI:

```javascript
import { loadRemoteData, createDataContextPrompt } from './utils/dataLoader';

// Load data
const rawData = await loadRemoteData(url, 'csv');

// Filter or transform data
const processedData = rawData
  .filter(row => row.category === 'important')
  .map(row => ({
    ...row,
    processed: true,
    timestamp: new Date(row.date).toISOString(),
  }));

// Create context with processed data
const systemPrompt = createDataContextPrompt(
  processedData,
  'You are analyzing filtered and processed data.',
  50
);
```

## Troubleshooting

### Data Not Loading

- Check the URL is correct and publicly accessible
- Verify CORS headers are set correctly
- Check browser console for errors

### Token Limit Exceeded

- Reduce the `maxRows` parameter
- Summarize data before passing to OpenAI
- Consider using pagination or filtering

### CSV Parsing Issues

- Ensure CSV uses standard formatting
- Check delimiter (default is comma)
- Verify no embedded line breaks in cells

## Full Working Example

You can try this feature by creating a simple HTML page:

```html
<!DOCTYPE html>
<html>
<head>
  <title>Chat with CSV Data</title>
  <script type="module">
    // Data loader utilities
    async function fetchRemoteData(url) {
      const response = await fetch(url);
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      return await response.text();
    }

    function parseCSV(csvText, delimiter = ',') {
      const lines = csvText.trim().split('\n');
      if (lines.length === 0) return [];

      const headers = lines[0].split(delimiter).map(h => h.trim().replace(/^"|"$/g, ''));
      const data = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(delimiter).map(v => v.trim().replace(/^"|"$/g, ''));
        if (values.length === headers.length) {
          const row = {};
          headers.forEach((header, index) => { row[header] = values[index]; });
          data.push(row);
        }
      }
      return data;
    }

    async function loadRemoteData(url, type = 'csv') {
      const rawData = await fetchRemoteData(url);
      if (type === 'csv') return parseCSV(rawData);
      if (type === 'json') return JSON.parse(rawData);
      throw new Error(`Unsupported type: ${type}`);
    }

    function createDataContextPrompt(data, basePrompt = '', maxRows = 50) {
      const limitedData = data.slice(0, maxRows);
      const headers = Object.keys(limitedData[0]);

      let formatted = `${basePrompt}\n\nYou have access to the following dataset:\n\n`;
      formatted += `Data Summary (${data.length} total rows, showing ${limitedData.length}):\n`;
      formatted += `Columns: ${headers.join(', ')}\n\nSample Data:\n`;

      limitedData.forEach((row, index) => {
        formatted += `Row ${index + 1}: ${JSON.stringify(row)}\n`;
      });

      return formatted;
    }

    // Initialize chat when page loads
    window.addEventListener('load', async () => {
      try {
        // Load your CSV data (must have CORS enabled)
        const data = await loadRemoteData(
          'https://raw.githubusercontent.com/plotly/datasets/master/iris.csv',
          'csv'
        );

        // Create system prompt with data
        const systemPrompt = createDataContextPrompt(
          data,
          'You are a helpful assistant that analyzes data.',
          50
        );

        // Configure Deep Chat
        const chatElement = document.getElementById('chat');
        chatElement.directConnection = {
          openAI: {
            key: 'YOUR_OPENAI_API_KEY_HERE', // Replace with your key
            chat: {
              system_prompt: systemPrompt,
              model: 'gpt-4o',
              max_tokens: 2000,
            },
          },
        };

        console.log('Data loaded successfully!', data.length, 'rows');
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to load data: ' + error.message);
      }
    });
  </script>
</head>
<body>
  <h1>Chat with Your CSV Data</h1>
  <deep-chat
    id="chat"
    style="height: 600px; border: 1px solid #ccc; border-radius: 8px;"
  ></deep-chat>

  <script type="module" src="https://cdn.jsdelivr.net/npm/deep-chat"></script>
</body>
</html>
```

### Try It Yourself

1. Save the code above as `index.html`
2. Replace `YOUR_OPENAI_API_KEY_HERE` with your OpenAI API key
3. Optionally change the CSV URL to your own data
4. Open the file in a browser
5. Start asking questions about your data!

Example questions to try:
- "What columns are in this dataset?"
- "How many rows of data do we have?"
- "Show me the first few rows"
- "What patterns can you see in the data?"
